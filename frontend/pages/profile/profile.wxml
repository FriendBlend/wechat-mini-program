<view class="container">
  <view class="top-container">
    <view class="top-container--namecard-row">
      <view class="top-container--namecard-placeholder">
        <view class="top-container--namecard">
          <namecard
            bind:tap="{{haveFastcard ? 'showNamecard' : 'showFastcardSetup'}}"
            name="{{currentUser.name}}"
            skin="{{currentUser.skin}}"
            avatarUrl="{{currentUser.avatar}}"
          ></namecard>
        </view>
      </view>
      <view class="option-buttons">
        <view class="option-button" bind:tap="showMenu">
          <image class="button-icon" src="../../images/icons/menu.svg"/>
        </view>
        <view class="option-button">
          <view wx:if="{{isCurrentUser}}">
            <image class="button-icon" src="../../images/icons/edit.png"/>
          </view>
          <view wx:else>
            <image wx:if="{{isFriend}}" class="button-icon" src="../../images/icons/delete.svg" bind:tap="deleteFriend"/>
            <image wx:else class="button-icon" src="../../images/icons/add.svg" bind:tap="addFriend"/>
          </view>
        </view>
        <view class="option-button">
          <view wx:if="{{isCurrentUser}}">
            <image class="button-icon" src="../../images/icons/chat.svg"/>
          </view>
          <view wx:else>
            <image class="button-icon" src="../../images/icons/greet.svg"/>
          </view>
          
        </view>
      </view>
    </view>
    <block wx:if="{{isCurrentUser && !haveFastcard}}">
      <view class="fastcard-button" bind:tap="showFastcardSetup">
        <view class="fastcard-title-en">Fastcard</view>
        <view class="fastcard-button--right">
          <view class="fastcard-free">Free</view>
          <view class="fastcard-title-cn">å¿«é€Ÿå¡ç‰‡</view>
        </view>
      </view>
    </block>
    <block wx:else>
      <swiper vertical="{{true}}" indicator-dots="{{true}}" indicator-active-color="white">
        <swiper-item class="tags-container">
          <block wx:for="{{currentUser.tags}}" wx:key="index">
            <view class="tag-block">{{item}}</view>
          </block>
        </swiper-item>
        <swiper-item></swiper-item>
      </swiper>
    </block>
  </view>

  <view class="bottom-container">
    <view class="tabs">
      <view class="tab {{activeTab == 'photos' ? 'active' : ''}}" id="photos" bind:tap="tabClick">
        <view class="tab-number">{{currentUser.photos.length}}</view>
        <view class="tab-text">ç›¸ç‰‡</view>
      </view>
      <view class="tab {{activeTab == 'friends' ? 'active' : ''}}" id="friends" bind:tap="tabClick">
        <view class="tab-number">{{friends.length}}</view>
        <view class="tab-text">æœ‹å‹</view>
      </view>
      <view class="tab {{activeTab == 'events' ? 'active' : ''}}" id="events" bind:tap="tabClick">
        <view class="tab-number">{{futureEvents.length + historyEvents.length}}</view>
        <view class="tab-text">äº‹ä»¶</view>
      </view>
    </view>
    <view class="photos-section" wx:if="{{activeTab == 'photos'}}">
      <image src="{{currentUser.photos[0]}}" mode="aspectFill"/>
      <image src="{{currentUser.photos[1]}}" mode="aspectFill"/>
      <image src="{{currentUser.photos[2]}}" mode="aspectFill"/>
      <view class="locked-photo-slot"></view>
    </view>
    <view class="friends-section" wx:if="{{activeTab == 'friends'}}">
      <!-- æœç´¢æ¡† -->
      <input class="search-input" bindinput="onSearchInput" placeholder="ğŸ”æœç´¢" />
      <!-- å…±åŒå¥½å‹ -->
      <view class="common-friends">
        <view class="profile-small-title">
          <image class="profile-small-icon" src="../../images/icons/common-friends.png"/>
          <view>å…±åŒå¥½å‹</view>
        </view>
        <scroll-view class="common-friends-list" scroll-x="true">
          <block wx:for="{{ filteredCommonFriends }}" wx:key="uid">
            <view class="common-friends--namecard">
              <namecard
                name="{{item.name}}"
              ></namecard>
            </view>
          </block>
        </scroll-view>
      </view>
      <!-- å¥½å‹åˆ—è¡¨ -->
      <view class="friends"> 
        <view class="profile-small-title">
          <image class="profile-small-icon" src="../../images/icons/friends.png"/>
          <view>Taçš„å¥½å‹</view>
        </view>
        <view class="friends-list">
          <block wx:for="{{filteredFriends}}" wx:key="uid">
            <view class="friends--namecard">
              <namecard
                name="{{item.name}}"
              ></namecard>
            </view>
          </block>
        </view>
      </view>
    </view>
    <!-- äº‹ä»¶é¡µé¢ -->
    <view class="events-section" wx:if="{{activeTab == 'events'}}">
      <block wx:if="{{isCurrentUser}}">
        <view class="followed-events">
          <view class="profile-small-title">
            <image class="profile-small-icon" src="/frontend/images/icons/events-common.svg"/>
            <view>å…³æ³¨äº‹ä»¶</view>
          </view>
          <scroll-view class="followed-events-list" scroll-x="true">
            <block wx:for="{{ followedEvents }}" wx:key="eid">
              <view class="followed-events-item">
                <svg external-class="ticket-base" src="/frontend/images/tickets/blue-ticket.svg" color="#10AEFF"></svg>
              </view>
            </block>
          </scroll-view>
        </view>
      </block>
      <block wx:else>
        <!-- å…±åŒäº‹ä»¶ -->
        <view class="common-events">
          <view class="profile-small-title">
            <image class="profile-small-icon" src="/frontend/images/icons/events-common.svg"/>
            <view>å…±åŒäº‹ä»¶</view>
          </view>
          <scroll-view class="common-events-list" scroll-x="true">
            <block wx:for="{{ commonEvents }}" wx:key="eid">
              <view class="common-events-item">
                <svg external-class="ticket-base" src="/frontend/images/tickets/blue-ticket.svg" color="#10AEFF"></svg>
              </view>
            </block>
          </scroll-view>
        </view>
      </block>
      <!-- æœªæ¥/å†å²äº‹ä»¶tabs -->
      <view class="events-tabs">
        <view id="future" bind:tap="eventsTabClick" class="profile-small-title events-tab {{activeEventsTab == 'future' ? 'events-tab--active' : ''}}">
          <svg external-class="profile-small-icon" src="/frontend/images/icons/events-future.svg" color="{{activeEventsTab == 'future' ? 'white' : '#333333'}}"></svg>
          <view>æœªæ¥äº‹ä»¶</view>
        </view>
        <view class="tab-divider">|</view>
        <view id="history" bind:tap="eventsTabClick" class="profile-small-title events-tab {{activeEventsTab == 'history' ? 'events-tab--active' : ''}}">
          <svg external-class="profile-small-icon" src="/frontend/images/icons/events-history.svg" color="{{activeEventsTab == 'history' ? 'white' : '#333333'}}"></svg>
          <view>å†å²äº‹ä»¶</view>
        </view>
      </view>
      <!-- æœªæ¥/å†å²äº‹ä»¶åˆ—è¡¨ -->
      <view class="scroll-view-wrapper">
        <view class="upper-blocker"></view>
        <view class="events-list--header-bg"></view>
        <view class="lower-blocker"></view>
        <scroll-view scroll-y="true" class="events-list" wx:if="{{activeEventsTab == 'future'}}">
          <block wx:for="{{ groupedFutureEvents }}" wx:key="index">
            <view class="events-list-group">
              <view class="events-list-header">
                <view>{{item[0].partyDate}}</view>
                <view class="events-list-header--month">{{item[0].partyMonth}}æœˆ</view>
              </view>
              <block wx:for="{{item}}" wx:key="index">
                <view class="events-list-item">
                  <event name="{{ item.partyName }}" 
                    avatar="{{ item.partyTypeEng }}" 
                    location="{{item.partyLocation.city}} {{item.partyLocation.district}}"
                    time="{{item.partyAmPm}} {{item.partyTime}}ç‚¹"
                    skin="{{item.partySkin}}"
                  ></event>
                </view>
              </block>
            </view>
          </block>
        </scroll-view>
        <scroll-view scroll-y="true" class="events-list" wx:else >
          <block wx:for="{{ groupedHistoryEvents }}" wx:key="index">
            <view class="events-list-group">
              <view class="events-list-header">
                <view>{{item[0].partyDate}}</view>
                <view class="events-list-header--month">{{item[0].partyMonth}}æœˆ</view>
              </view>
              <block wx:for="{{item}}" wx:key="index">
                <view class="events-list-item">
                  <event name="{{ item.partyName }}" 
                    avatar="{{ item.partyTypeEng }}" 
                    location="{{item.partyLocation.city}} {{item.partyLocation.district}}"
                    time="{{item.partyAmPm}} {{item.partyTime}}ç‚¹"
                    skin="{{item.partySkin}}"
                  ></event>
                </view>
              </block>
            </view>
          </block>
        </scroll-view>
      </view>
    </view>
  </view>
</view>
<!-- fastcard setup -->
<view class="fastcard-setup-container" wx:if="{{showFastcardSetup}}">
  <view class="fastcard-setup-backdrop" bind:tap="hideFastcardSetup"></view>
  <image class="fastcard-setup-close-btn" bindtap="hideFastcardSetup" src="/frontend/images/large-namecard/close-button.png"/>
  <view class="fastcard-setup-window">
    <view class="fastcard-setup-title">Fastcard</view>
    <view class="fastcard-setup-top">
      <view class="fastcard-setup-subtitle">ä»€ä¹ˆæ˜¯<text class="yellow-text">å¿«é€Ÿå¡ç‰‡</text>ï¼Ÿ</view>
      <view class="fastcard-setup-content-block">
        <view>
          <view class="fastcard-list-item">ä¸ªäººåç‰‡çš„æ‹“å±•çª—å£</view>
          <view class="fastcard-list-item">ç¤¾äº¤ä¿¡æ¯çš„é«˜æ•ˆå±•ç¤º</view>
          <view class="fastcard-list-item">ä¾¿äºåˆ†äº«çš„ç¤¾äº¤å¡ç‰‡</view>
        </view>
        <view bind:tap="showNamecard">
          <image class="fastcard-setup-namecard" src="/frontend/images/namecard/namecard.svg"/>
          <view class="fastcard-setup-label">ç‚¹å‡»é¢„è§ˆ</view>
        </view>
      </view>
    </view>
    <view class="fastcard-setup-bottom">
      <view class="fastcard-setup-subtitle">å¦‚ä½•åˆ›å»º<text class="yellow-text">å¿«é€Ÿå¡ç‰‡</text>ï¼Ÿ</view>
      <view class="fastcard-setup-content-block fastcard-setup-content-block--bottom">
        <view>
          <view class="fastcard-list-item fastcard-list-item--bottom">
            <view class="option-circle" style="background: {{fastcardSteps[0] ? '#23F788' : 'white'}};"></view>
            å®Œæˆè´¦æˆ·è®¾ç½®
          </view>
          <view class="fastcard-setup-label fastcard-setup-label--bottom">å¤´åƒã€åå¥½ç§°å‘¼ã€æ€§åˆ«</view>
          <view class="fastcard-list-item fastcard-list-item--bottom">
            <view class="option-circle" style="background: {{fastcardSteps[1] ? '#23F788' : 'white'}};"></view>
            ä¸Šä¼ è‡³å°‘1å¼ ç…§ç‰‡
          </view>
          <view class="fastcard-list-item fastcard-list-item--bottom">
            <view class="option-circle" style="background: {{fastcardSteps[2] ? '#23F788' : 'white'}};"></view>
            é€‰æ‹©è‡³å°‘1ä¸ªæ ‡ç­¾
          </view>
        </view>
        <view class="option-buttons">
          <view class="option-button">
            <image class="button-icon" src="../../images/icons/settings.svg"/>
          </view>
          <view class="option-button">
              <image class="button-icon" src="../../images/icons/edit.svg"/>
          </view>
        </view>
      </view>
    </view>
    <view class="fastcard-setup-create-button" bind:tap="createFastcard">åˆ›å»º</view>
  </view>
</view>
<!-- Large namecard -->
<large-namecard
  class="large-namecard"
  previewMode="{{true}}"
  showNamecard="{{showNamecard}}" 
  userName="{{currentUser.name}}" 
  userPictures="{{currentUser.photos}}" 
  userSkin="{{currentUser.skin}}"
  avatarUrl="/frontend/images/large-namecard/brady-avatar.JPG">
</large-namecard>
<!-- menu -->
<menu showMenu="{{showMenu}}" type="{{isCurrentUser ? 'profile-self' : 'profile-other'}}" isFriend="{{isFriend}}" position-class="menu-window"></menu>